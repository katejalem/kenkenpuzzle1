<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>KenKen — Cyber Hacker Edition</title>

<style>

@import url('https://fonts.googleapis.com/css2?family=Share+Tech+Mono&display=swap');
:root{
  --neon-1: 180,255,255;
  --neon-2: 120,255,140;
  --neon-3: 255,120,255;
  --bg-1: #000510;
  --panel: rgba(0,12,20,0.6);
  --cell-size: 64px;
}


*{box-sizing:border-box;margin:0;padding:0}
html,body{height:100%}
body{
  font-family:'Share Tech Mono', monospace;
  background:#000910;
  color:rgb(var(--neon-1));
  overflow:hidden;
  display:flex;
  align-items:center;
  justify-content:center;
}

#bgCanvas{
  position:fixed;
  inset:0;
  z-index:0;
  opacity:0.55;         
  filter:blur(0.5px);
}


.app{
  position:relative;
  z-index:2;
  width:min(980px,96%);
  padding:22px;
  background:rgba(3,18,26,0.6);
  border:1px solid rgba(0,255,255,0.08);
  border-radius:10px;
  box-shadow:0 0 30px rgba(0,255,255,0.06);
  backdrop-filter:blur(4px);
}

.header{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;}
.title h1{
  color:rgb(var(--neon-1));
  font-size:26px;
  text-shadow:0 0 10px rgba(var(--neon-1),0.18);
}
.title small{
  display:block;
  margin-top:6px;
  font-size:12px;
  color:rgba(255,255,255,0.45);
}

.controls{display:flex;align-items:center;gap:8px}

.select, .btn{
  background:transparent;
  border:1px solid rgba(0,255,255,0.14);
  color:rgb(var(--neon-1));
  padding:8px 12px;
  border-radius:6px;
  cursor:pointer;
  font-family:'Share Tech Mono';
  transition:0.2s;
}
.btn:hover{transform:translateY(-3px)}

.wrapper{display:flex;gap:18px;margin-top:8px}


.panel{
  flex:1;
  padding:14px;
  border-radius:8px;
  background:rgba(0,10,18,0.45);
  border:1px solid rgba(0,255,255,0.05);
}


.grid{
  display:grid;
  gap:4px;
  justify-content:center;
  margin:10px auto;
  padding:10px;
}
.cell{
  position:relative;
  width:var(--cell-size);
  height:var(--cell-size);
  border-radius:6px;
  background:rgba(0,0,0,0.35);
  display:flex;
  overflow:hidden;
  align-items:center;
  justify-content:center;
  transition:transform .14s;
}
.cell:hover{transform:translateY(-5px)}


.cell input{
  width:100%;height:100%;
  font-size:20px;
  color:rgb(var(--neon-1));
  background:transparent;
  border:none;
  text-align:center;
}


.cage-label{
  position:absolute;
  top:6px; left:6px;
  font-size:12px;
  padding:3px 6px;
  border-radius:4px;
  background:rgba(0,0,0,0.5);
  color:white;
}


.right{
  width:240px;
  padding:12px;
  border-radius:8px;
  background:rgba(0,0,0,0.25);
  font-size:13px;
  color:rgba(180,255,255,0.8);
}


#message{
  margin-top:6px;
  font-weight:700;
  color:rgb(var(--neon-3));
}


@media(max-width:900px){
  .wrapper{flex-direction:column}
  .right{width:100%}
}
</style>
</head>

<body>

<canvas id="bgCanvas"></canvas>

<div class="app">
  <div class="header">
    <div class="title">
      <h1>KENKEN — CYBER EDITION</h1>
      <small><strong>Group Members:</strong>  
        Kate Jalem, Quiziah Horcerada, Althea Tanguamos,  
        Archie Jutag, Kobe Dantes, Rosalden Rabago,  
        John Dexter Rada
      </small>
    </div>

    <div class="controls">
      <label for="size-select">Size</label>
      <select id="size-select" class="select">
        <option value="5">5 × 5</option>
        <option value="6">6 × 6</option>
        <option value="7">7 × 7</option>
        <option value="8">8 × 8</option>
        <option value="9">9 × 9</option>
      </select>
      <button class="btn" onclick="loadPuzzle()">Generate</button>
    </div>
  </div>

  <div class="wrapper">
    <div class="panel">
      <div id="kenken-grid" class="grid"></div>

      <div style="margin-top:12px;display:flex;gap:8px;">
        <button class="btn" onclick="checkSolution()">Check</button>
        <button class="select" onclick="showSolution()">Show</button>
        <div id="message"></div>
      </div>
    </div>

    <aside class="right">
      <strong>How to play</strong><br>
      Fill the grid with numbers 1–N, each row/column once.<br><br>
      Follow the cage target & operator.
    </aside>
  </div>
</div>

<script>

const canvas = document.getElementById("bgCanvas");
const ctx = canvas.getContext("2d");

let W = canvas.width = innerWidth;
let H = canvas.height = innerHeight;

let cols = Math.floor(W / 22);
let drops = new Array(cols).fill(1);

const glyphs = "01<>[]{}$#@".split("");  
function randGlyph(){ return glyphs[(Math.random()*glyphs.length)|0]; }

function resize(){
  W = canvas.width = innerWidth;
  H = canvas.height = innerHeight;
  cols = Math.floor(W / 22);
  drops = new Array(cols).fill(1);
}
addEventListener("resize", resize);

let last = 0;
function draw(ts){
  if(ts - last < 33){ requestAnimationFrame(draw); return; }
  last = ts;

  ctx.fillStyle = "rgba(0,0,0,0.18)";
  ctx.fillRect(0,0,W,H);

  ctx.fillStyle = "rgba(0,255,200,0.8)";
  ctx.font = "14px monospace";

  for(let i=0;i<drops.length;i++){
    let x = i * 22;
    let y = drops[i] * 22;
    ctx.fillText(randGlyph(), x, y);

    if(y > H && Math.random() > 0.98) drops[i] = 0;
    drops[i]++;
  }
  requestAnimationFrame(draw);
}
draw(0);


let currentSize = 5;
let solution = [];
let cages = [];

function shuffle(a){
  for(let i=a.length-1;i>0;i--){
    let j = Math.random()* (i+1) | 0;
    [a[i],a[j]]=[a[j],a[i]];
  }
  return a;
}

/* generate Latin square */
function generateSolution(n){
  let base = [...Array(n)].map((_,i)=>i+1);
  let b = [];
  for(let i=0;i<n;i++){
    b.push([...base]);
    base.push(base.shift());
  }
  return shuffle(b);
}


function generateCages(n){
  let list=[];
  let seen=[...Array(n)].map(()=>Array(n).fill(false));

  for(let r=0;r<n;r++){
    for(let c=0;c<n;c++){
      if(seen[r][c]) continue;

      let cells=[[r,c]];
      seen[r][c]=true;


      let size = Math.random()<0.6 ? 1 : 2;

      if(size===2){
        let opts=[[r+1,c],[r,c+1]].filter(([x,y])=>x<n&&y<n&&!seen[x][y]);
        if(opts.length){
          let [x,y]=opts[Math.random()*opts.length|0];
          cells.push([x,y]);
          seen[x][y]=true;
        }
      }

      const vals = cells.map(([x,y])=>solution[x][y]);

      let target = vals.reduce((a,b)=>a+b);
      let op = cells.length>1 ? "+" : "";

      list.push({cells,target,op});
    }
  }
  return list;
}


function buildGrid(n){
  const grid = document.getElementById("kenken-grid");
  grid.innerHTML="";
  grid.style.gridTemplateColumns=`repeat(${n}, var(--cell-size))`;

  let frag=document.createDocumentFragment();

  for(let i=0;i<n*n;i++){
    let cell=document.createElement("div");
    cell.className="cell";

    let inp=document.createElement("input");
    inp.type="number"; inp.min=1; inp.max=n;
    inp.oninput=e=>{
      let v=Math.floor(e.target.value);
      if(v<1||v>n||isNaN(v)) e.target.value="";
      else e.target.value=v;
    };

    cell.appendChild(inp);
    frag.appendChild(cell);
  }
  grid.appendChild(frag);
}

function renderCages(){
  const grid=document.getElementById("kenken-grid").children;

  cages.forEach(c=>{
    let [r,c0]=c.cells[0];
    let idx=r*currentSize+c0;

    let label=document.createElement("div");
    label.className="cage-label";
    label.textContent = c.op ? `${c.target}${c.op}` : c.target;
    grid[idx].appendChild(label);
  });
}

function loadPuzzle(){
  currentSize = Number(document.getElementById("size-select").value);
  solution = generateSolution(currentSize);
  cages = generateCages(currentSize);
  buildGrid(currentSize);
  renderCages();
  document.getElementById("message").textContent="";
}

function checkSolution(){
  const inp=document.querySelectorAll("#kenken-grid input");
  let correct=true;

  for(let r=0;r<currentSize;r++){
    for(let c=0;c<currentSize;c++){
      let val = Number(inp[r*currentSize+c].value);
      if(val !== solution[r][c]) correct=false;
    }
  }

  const msg=document.getElementById("message");
  msg.textContent = correct ? "✔ Correct!" : "✖ Incorrect.";
  msg.style.color = correct ? "lightgreen" : "pink";
}

function showSolution(){
  const inp=document.querySelectorAll("#kenken-grid input");
  for(let r=0;r<currentSize;r++){
    for(let c=0;c<currentSize;c++){
      inp[r*currentSize+c].value = solution[r][c];
    }
  }
  document.getElementById("message").textContent="Solution Revealed.";
}

/* initial */
loadPuzzle();
</script>

</body>
</html>
